<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Routine Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .card-header {
            background-color: #6c757d;
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: bold;
        }
        .form-check-input:checked {
            background-color: #28a745;
            border-color: #28a745;
        }
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
        .btn-success {
            background-color: #28a745;
            border-color: #28a745;
        }
        .point-badge {
            background-color: #17a2b8;
            color: white;
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #343a40;
        }
        .submenu {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 30px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .hidden {
            display: none;
        }
        .graph-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Login Section -->
    <div id="login-section" class="login-container">
        <h2 class="text-center mb-4">Daily Routine Tracker</h2>
        <div class="mb-3">
            <label for="login-email" class="form-label">Email</label>
            <input type="email" class="form-control" id="login-email" placeholder="Enter your email">
        </div>
        <div class="mb-3">
            <label for="login-password" class="form-label">Password</label>
            <input type="password" class="form-control" id="login-password" placeholder="Enter your password">
        </div>
        <button id="login-btn" class="btn btn-primary w-100 mb-3">Login</button>
        <button id="signup-btn" class="btn btn-secondary w-100">Sign Up</button>
        <div id="login-message" class="mt-3 text-center"></div>
    </div>

    <!-- Main App Section -->
    <div id="app-section" class="container mt-4 hidden">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Daily Routine Tracker</h1>
            <button id="logout-btn" class="btn btn-danger">Logout</button>
        </div>

        <div class="row">
            <!-- Daily Checklist Section -->
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        âœ… Daily Checklist
                    </div>
                    <div class="card-body">
                        <!-- Study Points Section -->
                        <div class="mb-4">
                            <h3 class="section-title">ðŸ…° Study Points</h3>
                            <div class="submenu">
                                <div class="form-check mb-2">
                                    <input class="form-check-input study-item" type="checkbox" value="1" id="math-class">
                                    <label class="form-check-label" for="math-class">
                                        Math class <span class="point-badge">+1</span>
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input study-item" type="checkbox" value="1" id="math-sheet">
                                    <label class="form-check-label" for="math-sheet">
                                        Math sheet <span class="point-badge">+1</span>
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input study-item" type="checkbox" value="1" id="vocabulary">
                                    <label class="form-check-label" for="vocabulary">
                                        Vocabulary <span class="point-badge">+1</span>
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input study-item" type="checkbox" value="1" id="grammar">
                                    <label class="form-check-label" for="grammar">
                                        Grammar <span class="point-badge">+1</span>
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input study-item" type="checkbox" value="1" id="revision">
                                    <label class="form-check-label" for="revision">
                                        Whole day revision <span class="point-badge">+1</span>
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input study-item" type="checkbox" value="2" id="pyq">
                                    <label class="form-check-label" for="pyq">
                                        PYQ <span class="point-badge">+2</span>
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input study-item" type="checkbox" value="2" id="mock-test">
                                    <label class="form-check-label" for="mock-test">
                                        Mock Test <span class="point-badge">+2</span>
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input study-item" type="checkbox" value="1" id="gk">
                                    <label class="form-check-label" for="gk">
                                        GK <span class="point-badge">+1</span>
                                    </label>
                                </div>
                                <div class="alert alert-info mt-3">
                                    <strong>Bonus:</strong> Complete all 5 basic tasks (1-5) for <span class="point-badge">+2</span> bonus points.
                                </div>
                                <div class="alert alert-warning">
                                    <strong>Penalty:</strong> 
                                    <ul>
                                        <li>Total study points 3 â†’ <span class="point-badge">-1</span></li>
                                        <li>Total study points 2 â†’ <span class="point-badge">-2</span></li>
                                        <li>Total study points 1 â†’ <span class="point-badge">-5</span></li>
                                        <li>Total study points 0 â†’ <span class="point-badge">-10</span></li>
                                    </ul>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-3">
                                    <h5>Total Study Points: <span id="study-points-total" class="point-badge">0</span></h5>
                                </div>
                            </div>
                        </div>

                        <!-- Entertainment Points Section -->
                        <div class="mb-4">
                            <h3 class="section-title">ðŸ…± Entertainment Points</h3>
                            <div class="submenu">
                                <div class="mb-3">
                                    <label for="entertainment-time" class="form-label">Enter time spent in HH:MM format:</label>
                                    <input type="text" class="form-control" id="entertainment-time" placeholder="00:00">
                                </div>
                                <button id="calculate-entertainment" class="btn btn-primary">Calculate Points</button>
                                <div class="mt-3">
                                    <h5>Entertainment Points: <span id="entertainment-points" class="point-badge">0</span></h5>
                                </div>
                                <div class="alert alert-info mt-3">
                                    <strong>Point System:</strong>
                                    <ul class="mb-0">
                                        <li>0â€“30 min â†’ <span class="point-badge">+7</span></li>
                                        <li>30+â€“1 hr â†’ <span class="point-badge">+4</span></li>
                                        <li>1â€“1.5 hr â†’ <span class="point-badge">+3</span></li>
                                        <li>1.5â€“2 hr â†’ <span class="point-badge">+2</span></li>
                                        <li>2â€“3 hr â†’ <span class="point-badge">+1</span></li>
                                        <li>3â€“3.5 hr â†’ <span class="point-badge">0</span></li>
                                        <li>3.5â€“4 hr â†’ <span class="point-badge">â€“1</span></li>
                                        <li>4â€“4.5 hr â†’ <span class="point-badge">â€“2</span></li>
                                        <li>4.5â€“5 hr â†’ <span class="point-badge">â€“3</span></li>
                                        <li>5â€“5.5 hr â†’ <span class="point-badge">â€“7</span></li>
                                        <li>5.5â€“6 hr â†’ <span class="point-badge">â€“10</span></li>
                                        <li>6+ hr â†’ <span class="point-badge">â€“25</span></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Habits Points Section -->
                        <div class="mb-4">
                            <h3 class="section-title">ðŸ…¾ Habits Points</h3>
                            <div class="submenu">
                                <!-- Wake-up Time -->
                                <div class="mb-3">
                                    <label for="wakeup-time" class="form-label">1. Wake-up Time:</label>
                                    <input type="time" class="form-control" id="wakeup-time">
                                    <div class="alert alert-info mt-2">
                                        <strong>Point System:</strong>
                                        <ul class="mb-0">
                                            <li>Before 5:30 am â†’ <span class="point-badge">+3</span></li>
                                            <li>5:30â€“6:00 am â†’ <span class="point-badge">0</span></li>
                                            <li>6:00â€“6:30 am â†’ <span class="point-badge">â€“1</span></li>
                                            <li>6:30â€“7:00 am â†’ <span class="point-badge">â€“2</span></li>
                                            <li>7:00â€“7:30 am â†’ <span class="point-badge">â€“5</span></li>
                                            <li>7:30+ am â†’ <span class="point-badge">â€“10</span></li>
                                        </ul>
                                    </div>
                                    <div class="mt-2">
                                        Wake-up Points: <span id="wakeup-points" class="point-badge">0</span>
                                    </div>
                                </div>

                                <!-- Workout -->
                                <div class="mb-3">
                                    <label class="form-label">2. Workout:</label>
                                    <select class="form-select" id="workout-type">
                                        <option value="">Select workout type</option>
                                        <option value="run">Run</option>
                                        <option value="meditation">Meditation</option>
                                    </select>
                                    <div class="alert alert-info mt-2">
                                        <strong>Point System:</strong>
                                        <ul class="mb-0">
                                            <li>Run â†’ <span class="point-badge">+1</span></li>
                                            <li>Meditation â†’ <span class="point-badge">+1</span></li>
                                        </ul>
                                    </div>
                                    <div class="mt-2">
                                        Workout Points: <span id="workout-points" class="point-badge">0</span>
                                    </div>
                                </div>

                                <!-- Bath Time -->
                                <div class="mb-3">
                                    <label for="bath-time" class="form-label">3. Bath Time:</label>
                                    <input type="time" class="form-control" id="bath-time">
                                    <div class="alert alert-info mt-2">
                                        <strong>Point System:</strong>
                                        <ul class="mb-0">
                                            <li>Before 12:30 pm â†’ <span class="point-badge">0</span></li>
                                            <li>12:30â€“1:30 pm â†’ <span class="point-badge">â€“1</span></li>
                                            <li>1:30â€“2:30 pm â†’ <span class="point-badge">â€“2</span></li>
                                            <li>After 2:30 pm â†’ <span class="point-badge">â€“3</span></li>
                                        </ul>
                                    </div>
                                    <div class="mt-2">
                                        Bath Points: <span id="bath-points" class="point-badge">0</span>
                                    </div>
                                </div>

                                <!-- Sleep Time -->
                                <div class="mb-3">
                                    <label for="sleep-time" class="form-label">4. Sleep Time:</label>
                                    <input type="time" class="form-control" id="sleep-time">
                                </div>

                                <!-- Special Task -->
                                <div class="mb-3">
                                    <label class="form-label">5. Special Task:</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="follow" id="special-follow">
                                        <label class="form-check-label" for="special-follow">
                                            Follow <span class="point-badge">+1</span>
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="break" id="special-break">
                                        <label class="form-check-label" for="special-break">
                                            Break <span class="point-badge">â€“10</span>
                                        </label>
                                    </div>
                                    <div class="mt-2">
                                        Special Task Points: <span id="special-points" class="point-badge">0</span>
                                    </div>
                                </div>

                                <!-- Extra Points -->
                                <div class="mb-3">
                                    <h5>âœ¨ Extra Points</h5>
                                    <div class="alert alert-info">
                                        <strong>Conditions:</strong>
                                        <ul>
                                            <li>Wake-up before 5:00 am</li>
                                            <li>Workout morethan 1</li>
                                            <li>Bath before 12:00 pm</li>
                                            <li>Sleep before 11:00 pm</li>
                                            <li>Special Task followed</li>
                                        </ul>
                                        <strong>Rewards:</strong>
                                        <ul class="mb-0">
                                            <li>2/5 â†’ <span class="point-badge">+1</span></li>
                                            <li>3/5 â†’ <span class="point-badge">+2</span></li>
                                            <li>4/5 â†’ <span class="point-badge">+5</span></li>
                                            <li>5/5 â†’ <span class="point-badge">+7</span></li>
                                        </ul>
                                    </div>
                                    <div class="mt-2">
                                        Extra Points: <span id="extra-points" class="point-badge">0</span>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-between align-items-center mt-3">
                                    <h5>Total Habits Points: <span id="habits-points-total" class="point-badge">0</span></h5>
                                </div>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="text-center mt-4">
                            <button id="submit-data" class="btn btn-success btn-lg">Save Today's Data</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Graph & Stats Section -->
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        ðŸ“ˆ Graph & Stats
                    </div>
                    <div class="card-body">
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <label for="time-period" class="form-label">Time Period:</label>
                                <select class="form-select" id="time-period">
                                    <option value="today">Today</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="graph-type" class="form-label">Graph Type:</label>
                                <select class="form-select" id="graph-type">
                                    <option value="total">Total Points</option>
                                    <option value="study">Study Points</option>
                                    <option value="entertainment">Entertainment Points</option>
                                    <option value="habits">Habits Points</option>
                                    <option value="wakeup">Wake-up Points</option>
                                    <option value="workout">Workout Points</option>
                                    <option value="bath">Bath Points</option>
                                    <option value="sleep">Sleep Time</option>
                                    <option value="special">Special Task Points</option>
                                </select>
                            </div>
                            <div class="col-md-4 d-flex align-items-end">
                                <button id="view-graph" class="btn btn-primary w-100">View Graph</button>
                            </div>
                        </div>
                        <div class="graph-container">
                            <canvas id="stats-chart"></canvas>
                        </div>
                        <div class="mt-3">
                            <h5>Compare Multiple Metrics</h5>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input compare-metric" type="checkbox" value="study" id="compare-study">
                                <label class="form-check-label" for="compare-study">Study Points</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input compare-metric" type="checkbox" value="entertainment" id="compare-entertainment">
                                <label class="form-check-label" for="compare-entertainment">Entertainment Points</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input compare-metric" type="checkbox" value="habits" id="compare-habits">
                                <label class="form-check-label" for="compare-habits">Habits Points</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input compare-metric" type="checkbox" value="wakeup" id="compare-wakeup">
                                <label class="form-check-label" for="compare-wakeup">Wake-up Points</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input compare-metric" type="checkbox" value="workout" id="compare-workout">
                                <label class="form-check-label" for="compare-workout">Workout Points</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input compare-metric" type="checkbox" value="bath" id="compare-bath">
                                <label class="form-check-label" for="compare-bath">Bath Points</label>
                            </div>
                            <button id="compare-graph" class="btn btn-secondary mt-2">Compare Selected</button>
                        </div>
                        <div class="graph-container mt-4 hidden" id="compare-container">
                            <canvas id="compare-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total Points Display -->
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body text-center">
                        <h2>Today's Total Points: <span id="total-points" class="point-badge" style="font-size: 2rem;">0</span></h2>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCV4tM0lGEu1w46YjCkP3j_OKFiGQZDadY",
  authDomain: "vocab-bfafe.firebaseapp.com",
  databaseURL: "https://vocab-bfafe-default-rtdb.firebaseio.com",
  projectId: "vocab-bfafe",
  storageBucket: "vocab-bfafe.firebasestorage.app",
  messagingSenderId: "503851407373",
  appId: "1:503851407373:web:9ae98ad47e4852fb1f1d44"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // DOM Elements
        const loginSection = document.getElementById('login-section');
        const appSection = document.getElementById('app-section');
        const loginBtn = document.getElementById('login-btn');
        const signupBtn = document.getElementById('signup-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const loginMessage = document.getElementById('login-message');
        const loginEmail = document.getElementById('login-email');
        const loginPassword = document.getElementById('login-password');

        // Authentication functions
        loginBtn.addEventListener('click', () => {
            const email = loginEmail.value;
            const password = loginPassword.value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    loginMessage.textContent = "Login successful!";
                    loginMessage.style.color = "green";
                    showApp();
                })
                .catch((error) => {
                    loginMessage.textContent = error.message;
                    loginMessage.style.color = "red";
                });
        });

        signupBtn.addEventListener('click', () => {
            const email = loginEmail.value;
            const password = loginPassword.value;
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    loginMessage.textContent = "Account created successfully!";
                    loginMessage.style.color = "green";
                })
                .catch((error) => {
                    loginMessage.textContent = error.message;
                    loginMessage.style.color = "red";
                });
        });

        logoutBtn.addEventListener('click', () => {
            auth.signOut()
                .then(() => {
                    showLogin();
                })
                .catch((error) => {
                    console.error("Logout error:", error);
                });
        });

        // Check auth state
        auth.onAuthStateChanged((user) => {
            if (user) {
                showApp();
            } else {
                showLogin();
            }
        });

        function showLogin() {
            loginSection.classList.remove('hidden');
            appSection.classList.add('hidden');
        }

        function showApp() {
            loginSection.classList.add('hidden');
            appSection.classList.remove('hidden');
            loadUserData();
        }

        // App functionality
        let today = new Date().toISOString().split('T')[0];
        let currentUser = null;

        // Study Points Calculation
        const studyItems = document.querySelectorAll('.study-item');
        const studyPointsTotal = document.getElementById('study-points-total');
        
        studyItems.forEach(item => {
            item.addEventListener('change', calculateStudyPoints);
        });

        function calculateStudyPoints() {
            let total = 0;
            studyItems.forEach(item => {
                if (item.checked) {
                    total += parseInt(item.value);
                }
            });
            
            // Check for bonus (items 1-5 all checked)
            const basicItems = Array.from(studyItems).slice(0, 5);
            const allBasicChecked = basicItems.every(item => item.checked);
            if (allBasicChecked) {
                total += 2;
            }
            
            // Apply penalties
            if (total === 3) {
                total -= 1;
            } else if (total === 2) {
                total -= 2;
            } else if (total === 1) {
                total -= 5;
            } else if (total === 0) {
                total -= 10;
            }
            
            studyPointsTotal.textContent = total;
            calculateTotalPoints();
            return total;
        }

        // Entertainment Points Calculation
        const entertainmentTimeInput = document.getElementById('entertainment-time');
        const entertainmentPointsDisplay = document.getElementById('entertainment-points');
        const calculateEntertainmentBtn = document.getElementById('calculate-entertainment');

        calculateEntertainmentBtn.addEventListener('click', calculateEntertainmentPoints);

        function calculateEntertainmentPoints() {
            const timeString = entertainmentTimeInput.value;
            if (!timeString) return 0;
            
            const [hours, minutes] = timeString.split(':').map(Number);
            const totalMinutes = hours * 60 + minutes;
            let points = 0;
            
            if (totalMinutes <= 30) points = 7;
            else if (totalMinutes <= 60) points = 4;
            else if (totalMinutes <= 90) points = 3;
            else if (totalMinutes <= 120) points = 2;
            else if (totalMinutes <= 180) points = 1;
            else if (totalMinutes <= 210) points = 0;
            else if (totalMinutes <= 240) points = -1;
            else if (totalMinutes <= 270) points = -2;
            else if (totalMinutes <= 300) points = -3;
            else if (totalMinutes <= 330) points = -7;
            else if (totalMinutes <= 360) points = -10;
            else points = -25;
            
            entertainmentPointsDisplay.textContent = points;
            calculateTotalPoints();
            return points;
        }

        // Habits Points Calculation
        const wakeupTimeInput = document.getElementById('wakeup-time');
        const wakeupPointsDisplay = document.getElementById('wakeup-points');
        const workoutTypeSelect = document.getElementById('workout-type');
        const workoutPointsDisplay = document.getElementById('workout-points');
        const bathTimeInput = document.getElementById('bath-time');
        const bathPointsDisplay = document.getElementById('bath-points');
        const sleepTimeInput = document.getElementById('sleep-time');
        const specialFollowCheck = document.getElementById('special-follow');
        const specialBreakCheck = document.getElementById('special-break');
        const specialPointsDisplay = document.getElementById('special-points');
        const extraPointsDisplay = document.getElementById('extra-points');
        const habitsPointsTotal = document.getElementById('habits-points-total');

        // Add event listeners
        wakeupTimeInput.addEventListener('change', calculateHabitsPoints);
        workoutTypeSelect.addEventListener('change', calculateHabitsPoints);
        bathTimeInput.addEventListener('change', calculateHabitsPoints);
        sleepTimeInput.addEventListener('change', calculateHabitsPoints);
        specialFollowCheck.addEventListener('change', function() {
            if (this.checked) specialBreakCheck.checked = false;
            calculateHabitsPoints();
        });
        specialBreakCheck.addEventListener('change', function() {
            if (this.checked) specialFollowCheck.checked = false;
            calculateHabitsPoints();
        });

        function calculateHabitsPoints() {
            // Wake-up points
            const wakeupTime = wakeupTimeInput.value;
            let wakeupPoints = 0;
            
            if (wakeupTime) {
                const [hours, minutes] = wakeupTime.split(':').map(Number);
                const totalMinutes = hours * 60 + minutes;
                
                if (totalMinutes < 5.5 * 60) wakeupPoints = 3; // Before 5:30
                else if (totalMinutes < 6 * 60) wakeupPoints = 0; // 5:30-6:00
                else if (totalMinutes < 6.5 * 60) wakeupPoints = -1; // 6:00-6:30
                else if (totalMinutes < 7 * 60) wakeupPoints = -2; // 6:30-7:00
                else if (totalMinutes < 7.5 * 60) wakeupPoints = -5; // 7:00-7:30
                else wakeupPoints = -10; // After 7:30
            }
            
            wakeupPointsDisplay.textContent = wakeupPoints;
            
            // Workout points
            const workoutType = workoutTypeSelect.value;
            let workoutPoints = 0;
            
            if (workoutType === 'run' || workoutType === 'meditation') {
                workoutPoints = 1;
            }
            
            workoutPointsDisplay.textContent = workoutPoints;
            
            // Bath points
            const bathTime = bathTimeInput.value;
            let bathPoints = 0;
            
            if (bathTime) {
                const [hours, minutes] = bathTime.split(':').map(Number);
                const totalMinutes = hours * 60 + minutes;
                
                if (totalMinutes < 12.5 * 60) bathPoints = 0; // Before 12:30
                else if (totalMinutes < 13.5 * 60) bathPoints = -1; // 12:30-1:30
                else if (totalMinutes < 14.5 * 60) bathPoints = -2; // 1:30-2:30
                else bathPoints = -3; // After 2:30
            }
            
            bathPointsDisplay.textContent = bathPoints;
            
            // Special task points
            let specialPoints = 0;
            
            if (specialFollowCheck.checked) {
                specialPoints = 1;
            } else if (specialBreakCheck.checked) {
                specialPoints = -10;
            }
            
            specialPointsDisplay.textContent = specialPoints;
            
            // Calculate extra points
            let extraPoints = 0;
            let conditionsMet = 0;
            
            // Check wake-up before 5:00 am
            if (wakeupTime) {
                const [hours, minutes] = wakeupTime.split(':').map(Number);
                if (hours < 5 || (hours === 5 && minutes === 0)) {
                    conditionsMet++;
                }
            }
            
            // Check workout > 1 (currently max is 1, so this would always be false)
            if (workoutPoints >= 1) {
                conditionsMet++;
            }
            
            // Check bath before 12:00 pm
            if (bathTime) {
                const [hours, minutes] = bathTime.split(':').map(Number);
                if (hours < 12) {
                    conditionsMet++;
                }
            }
            
            // Check sleep before 11:00 pm
            const sleepTime = sleepTimeInput.value;
            if (sleepTime) {
                const [hours, minutes] = sleepTime.split(':').map(Number);
                if (hours < 23) {
                    conditionsMet++;
                }
            }
            
            // Check special task followed
            if (specialFollowCheck.checked) {
                conditionsMet++;
            }
            
            // Calculate extra points based on conditions met
            if (conditionsMet >= 2) {
                if (conditionsMet === 2) extraPoints = 1;
                else if (conditionsMet === 3) extraPoints = 2;
                else if (conditionsMet === 4) extraPoints = 5;
                else if (conditionsMet === 5) extraPoints = 7;
            }
            
            extraPointsDisplay.textContent = extraPoints;
            
            // Calculate total habits points
            const totalHabitsPoints = wakeupPoints + workoutPoints + bathPoints + specialPoints + extraPoints;
            habitsPointsTotal.textContent = totalHabitsPoints;
            
            calculateTotalPoints();
            return totalHabitsPoints;
        }

        // Total Points Calculation
        const totalPointsDisplay = document.getElementById('total-points');

        function calculateTotalPoints() {
            const studyPoints = parseInt(studyPointsTotal.textContent) || 0;
            const entertainmentPoints = parseInt(entertainmentPointsDisplay.textContent) || 0;
            const habitsPoints = parseInt(habitsPointsTotal.textContent) || 0;
            
            const totalPoints = studyPoints + entertainmentPoints + habitsPoints;
            totalPointsDisplay.textContent = totalPoints;
            
            return totalPoints;
        }

        // Save data to Firebase
        const submitDataBtn = document.getElementById('submit-data');

        submitDataBtn.addEventListener('click', saveDataToFirebase);

        function saveDataToFirebase() {
    if (!auth.currentUser) return;

    const userId = auth.currentUser.uid;
    const date = new Date().toISOString().split('T')[0];

    const selectedStudyItems = Array.from(studyItems)
        .filter(item => item.checked)
        .map(item => item.id);

    const data = {
        date: date,
        studyPoints: selectedStudyItems,
        entertainmentTime: entertainmentTimeInput.value,
        entertainmentPoints: calculateEntertainmentPoints(),
        habitsPoints: calculateHabitsPoints(),
        totalPoints: calculateTotalPoints(),
        wakeupTime: wakeupTimeInput.value,
        workoutType: workoutTypeSelect.value,
        bathTime: bathTimeInput.value,
        sleepTime: sleepTimeInput.value,
        specialTask: specialFollowCheck.checked ? 'follow' : (specialBreakCheck.checked ? 'break' : 'none'),
        timestamp: firebase.database.ServerValue.TIMESTAMP
    };

    database.ref('users/' + userId + '/records/' + date).set(data)
        .then(() => {
            alert('Data saved successfully!');
        })
        .catch((error) => {
            alert('Error saving data: ' + error.message);
        });
}

function loadUserData() {
    if (!auth.currentUser) return;

    const userId = auth.currentUser.uid;
    const date = new Date().toISOString().split('T')[0];

    database.ref('users/' + userId + '/records/' + date).once('value')
        .then((snapshot) => {
            const data = snapshot.val();
            if (data) {
 // Pre-select study points
studyItems.forEach(item => {
    item.checked = Array.isArray(data.studyPoints) && data.studyPoints.includes(item.id);
});

                // Pre-fill entertainment points
                if (data.entertainmentTime) {
                    entertainmentTimeInput.value = data.entertainmentTime;
                    entertainmentPointsDisplay.textContent = data.entertainmentPoints || 0;
                }

                // Pre-fill habits data
                if (data.wakeupTime) {
                    wakeupTimeInput.value = data.wakeupTime;
                    wakeupPointsDisplay.textContent = data.wakeupPoints || 0;
                }

                if (data.workoutType) {
                    workoutTypeSelect.value = data.workoutType;
                    workoutPointsDisplay.textContent = data.workoutPoints || 0;
                }

                if (data.bathTime) {
                    bathTimeInput.value = data.bathTime;
                    bathPointsDisplay.textContent = data.bathPoints || 0;
                }

                if (data.sleepTime) {
                    sleepTimeInput.value = data.sleepTime;
                }

                if (data.specialTask === 'follow') {
                    specialFollowCheck.checked = true;
                    specialBreakCheck.checked = false;
                    specialPointsDisplay.textContent = 1;
                } else if (data.specialTask === 'break') {
                    specialFollowCheck.checked = false;
                    specialBreakCheck.checked = true;
                    specialPointsDisplay.textContent = -10;
                }

                if (data.extraPoints !== undefined) {
                    extraPointsDisplay.textContent = data.extraPoints;
                }

                if (data.habitsPoints !== undefined) {
                    habitsPointsTotal.textContent = data.habitsPoints;
                }

                if (data.totalPoints !== undefined) {
                    totalPointsDisplay.textContent = data.totalPoints;
                }
            }
        })
        .catch((error) => {
            console.error("Error loading data:", error);
        });
}

        // Graph functionality
        const viewGraphBtn = document.getElementById('view-graph');
        const timePeriodSelect = document.getElementById('time-period');
        const graphTypeSelect = document.getElementById('graph-type');
        const statsChartCanvas = document.getElementById('stats-chart');
        const compareGraphBtn = document.getElementById('compare-graph');
        const compareContainer = document.getElementById('compare-container');
        const compareChartCanvas = document.getElementById('compare-chart');
        const compareMetrics = document.querySelectorAll('.compare-metric');

        let statsChart = null;
        let compareChart = null;

        viewGraphBtn.addEventListener('click', generateGraph);
        compareGraphBtn.addEventListener('click', generateCompareGraph);

        function generateGraph() {
            if (!auth.currentUser) return;
            
            const userId = auth.currentUser.uid;
            const period = timePeriodSelect.value;
            const type = graphTypeSelect.value;
            
            let startDate, endDate;
            const today = new Date();
            
            if (period === 'today') {
                startDate = new Date(today);
                startDate.setHours(0, 0, 0, 0);
                endDate = new Date(today);
                endDate.setHours(23, 59, 59, 999);
            } else if (period === 'week') {
                startDate = new Date(today);
                startDate.setDate(today.getDate() - today.getDay()); // Start of week (Sunday)
                startDate.setHours(0, 0, 0, 0);
                endDate = new Date(today);
                endDate.setDate(today.getDate() + (6 - today.getDay())); // End of week (Saturday)
                endDate.setHours(23, 59, 59, 999);
            } else { // month
                startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                endDate.setHours(23, 59, 59, 999);
            }
            
            database.ref('users/' + userId + '/records')
                .orderByChild('timestamp')
                .startAt(startDate.getTime())
                .endAt(endDate.getTime())
                .once('value')
                .then((snapshot) => {
                    const records = [];
                    snapshot.forEach((childSnapshot) => {
                        records.push(childSnapshot.val());
                    });
                    
                    // Sort records by date
                    records.sort((a, b) => new Date(a.date) - new Date(b.date));
                    
                    // Prepare data for chart
                    const labels = records.map(record => record.date);
                    let data = [];
                    let label = '';
                    
                    switch (type) {
                        case 'total':
                            data = records.map(record => record.totalPoints);
                            label = 'Total Points';
                            break;
                        case 'study':
                            data = records.map(record => record.studyPoints);
                            label = 'Study Points';
                            break;
                        case 'entertainment':
                            data = records.map(record => record.entertainmentPoints);
                            label = 'Entertainment Points';
                            break;
                        case 'habits':
                            data = records.map(record => record.habitsPoints);
                            label = 'Habits Points';
                            break;
                        case 'wakeup':
                            data = records.map(record => {
                                const time = record.wakeupTime;
                                if (!time) return 0;
                                const [hours, minutes] = time.split(':').map(Number);
                                const totalMinutes = hours * 60 + minutes;
                                
                                if (totalMinutes < 5.5 * 60) return 3;
                                else if (totalMinutes < 6 * 60) return 0;
                                else if (totalMinutes < 6.5 * 60) return -1;
                                else if (totalMinutes < 7 * 60) return -2;
                                else if (totalMinutes < 7.5 * 60) return -5;
                                else return -10;
                            });
                            label = 'Wake-up Points';
                            break;
                        case 'workout':
                            data = records.map(record => {
                                if (record.workoutType === 'run' || record.workoutType === 'meditation') return 1;
                                return 0;
                            });
                            label = 'Workout Points';
                            break;
                        case 'bath':
                            data = records.map(record => {
                                const time = record.bathTime;
                                if (!time) return 0;
                                const [hours, minutes] = time.split(':').map(Number);
                                const totalMinutes = hours * 60 + minutes;
                                
                                if (totalMinutes < 12.5 * 60) return 0;
                                else if (totalMinutes < 13.5 * 60) return -1;
                                else if (totalMinutes < 14.5 * 60) return -2;
                                else return -3;
                            });
                            label = 'Bath Points';
                            break;
                        case 'sleep':
                            data = records.map(record => {
                                const time = record.sleepTime;
                                if (!time) return null;
                                const [hours, minutes] = time.split(':').map(Number);
                                return hours + minutes / 60;
                            });
                            label = 'Sleep Time (hours)';
                            break;
                        case 'special':
                            data = records.map(record => {
                                if (record.specialTask === 'follow') return 1;
                                else if (record.specialTask === 'break') return -10;
                                return 0;
                            });
                            label = 'Special Task Points';
                            break;
                    }
                    
                    // Create or update chart
                    if (statsChart) {
                        statsChart.destroy();
                    }
                    
                    const ctx = statsChartCanvas.getContext('2d');
                    statsChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: label,
                                data: data,
                                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 2,
                                tension: 0.1,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: `${label} Over Time (${period === 'today' ? 'Today' : period === 'week' ? 'This Week' : 'This Month'})`
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: type !== 'sleep'
                                }
                            }
                        }
                    });
                })
                .catch((error) => {
                    console.error("Error loading data for graph:", error);
                });
        }

        function generateCompareGraph() {
            if (!auth.currentUser) return;
            
            const userId = auth.currentUser.uid;
            const period = timePeriodSelect.value;
            const selectedMetrics = Array.from(compareMetrics)
                .filter(metric => metric.checked)
                .map(metric => metric.value);
            
            if (selectedMetrics.length === 0) {
                alert('Please select at least one metric to compare');
                return;
            }
            
            let startDate, endDate;
            const today = new Date();
            
            if (period === 'today') {
                startDate = new Date(today);
                startDate.setHours(0, 0, 0, 0);
                endDate = new Date(today);
                endDate.setHours(23, 59, 59, 999);
            } else if (period === 'week') {
                startDate = new Date(today);
                startDate.setDate(today.getDate() - today.getDay()); // Start of week (Sunday)
                startDate.setHours(0, 0, 0, 0);
                endDate = new Date(today);
                endDate.setDate(today.getDate() + (6 - today.getDay())); // End of week (Saturday)
                endDate.setHours(23, 59, 59, 999);
            } else { // month
                startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                endDate.setHours(23, 59, 59, 999);
            }
            
            database.ref('users/' + userId + '/records')
                .orderByChild('timestamp')
                .startAt(startDate.getTime())
                .endAt(endDate.getTime())
                .once('value')
                .then((snapshot) => {
                    const records = [];
                    snapshot.forEach((childSnapshot) => {
                        records.push(childSnapshot.val());
                    });
                    
                    // Sort records by date
                    records.sort((a, b) => new Date(a.date) - new Date(b.date));
                    
                    // Prepare data for chart
                    const labels = records.map(record => record.date);
                    const datasets = [];
                    
                    // Colors for different metrics
                    const colors = [
                        { bg: 'rgba(255, 99, 132, 0.2)', border: 'rgba(255, 99, 132, 1)' },
                        { bg: 'rgba(54, 162, 235, 0.2)', border: 'rgba(54, 162, 235, 1)' },
                        { bg: 'rgba(255, 206, 86, 0.2)', border: 'rgba(255, 206, 86, 1)' },
                        { bg: 'rgba(75, 192, 192, 0.2)', border: 'rgba(75, 192, 192, 1)' },
                        { bg: 'rgba(153, 102, 255, 0.2)', border: 'rgba(153, 102, 255, 1)' },
                        { bg: 'rgba(255, 159, 64, 0.2)', border: 'rgba(255, 159, 64, 1)' }
                    ];
                    
                    selectedMetrics.forEach((metric, index) => {
                        let data = [];
                        let label = '';
                        
                        switch (metric) {
                            case 'total':
                                data = records.map(record => record.totalPoints);
                                label = 'Total Points';
                                break;
                            case 'study':
                                data = records.map(record => record.studyPoints);
                                label = 'Study Points';
                                break;
                            case 'entertainment':
                                data = records.map(record => record.entertainmentPoints);
                                label = 'Entertainment Points';
                                break;
                            case 'habits':
                                data = records.map(record => record.habitsPoints);
                                label = 'Habits Points';
                                break;
                            case 'wakeup':
                                data = records.map(record => {
                                    const time = record.wakeupTime;
                                    if (!time) return 0;
                                    const [hours, minutes] = time.split(':').map(Number);
                                    const totalMinutes = hours * 60 + minutes;
                                    
                                    if (totalMinutes < 5.5 * 60) return 3;
                                    else if (totalMinutes < 6 * 60) return 0;
                                    else if (totalMinutes < 6.5 * 60) return -1;
                                    else if (totalMinutes < 7 * 60) return -2;
                                    else if (totalMinutes < 7.5 * 60) return -5;
                                    else return -10;
                                });
                                label = 'Wake-up Points';
                                break;
                            case 'workout':
                                data = records.map(record => {
                                    if (record.workoutType === 'run' || record.workoutType === 'meditation') return 1;
                                    return 0;
                                });
                                label = 'Workout Points';
                                break;
                            case 'bath':
                                data = records.map(record => {
                                    const time = record.bathTime;
                                    if (!time) return 0;
                                    const [hours, minutes] = time.split(':').map(Number);
                                    const totalMinutes = hours * 60 + minutes;
                                    
                                    if (totalMinutes < 12.5 * 60) return 0;
                                    else if (totalMinutes < 13.5 * 60) return -1;
                                    else if (totalMinutes < 14.5 * 60) return -2;
                                    else return -3;
                                });
                                label = 'Bath Points';
                                break;
                        }
                        
                        datasets.push({
                            label: label,
                            data: data,
                            backgroundColor: colors[index % colors.length].bg,
                            borderColor: colors[index % colors.length].border,
                            borderWidth: 2,
                            tension: 0.1,
                            fill: false
                        });
                    });
                    
                    // Show compare container if hidden
                    compareContainer.classList.remove('hidden');
                    
                    // Create or update chart
                    if (compareChart) {
                        compareChart.destroy();
                    }
                    
                    const ctx = compareChartCanvas.getContext('2d');
                    compareChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: datasets
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: `Comparison of Selected Metrics (${period === 'today' ? 'Today' : period === 'week' ? 'This Week' : 'This Month'})`
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                })
                .catch((error) => {
                    console.error("Error loading data for compare graph:", error);
                });
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Check if user is logged in
            auth.onAuthStateChanged((user) => {
                if (user) {
                    showApp();
                } else {
                    showLogin();
                }
            });
        });
    </script>
</body>
</html>
